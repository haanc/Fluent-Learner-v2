# 项目开发路线图 Brainstorming

## 基本信息

| 项目 | 内容 |
|------|------|
| **讨论日期** | 2026-01-20 |
| **当前版本** | v0.1.0 |
| **项目状态** | 核心功能稳定，UI/UX 大幅改进 |
| **参与者** | Han Cao, Claude |
| **最后更新** | 2026-01-23 |

---

## 背景

在 v0.0.7 版本发布后，项目核心功能（视频导入、转录、翻译、AI Tutor）已经稳定运行。需要规划下一阶段的开发方向，从多个可能的路径中选择优先级。

---

## Brainstorming 讨论记录

### 问题：项目下一阶段应该往哪个方向发展？

Claude 提出了六个主要的开发方向供选择：

### 方向 1: UI/UX 改进

**目标**：修复显示 bug 和界面改进

**具体内容**：
- 修复已知的 UI 显示问题
- 改善用户交互体验
- 优化界面布局和视觉设计

### 方向 2: 商业化 (Monetization)

**目标**：实现会员登录和付费订阅模式

**具体内容**：
- 会员登录系统
- 付费订阅模式设计
- 付费/免费/游客账户的功能边界划分
- 可能需要开发 Landing Page

### 方向 3: 性能优化

**目标**：改善功能加载速度

**具体内容**：
- 翻译功能加载时间优化
- 单词查询响应速度优化
- AI Tutor 响应速度优化
- 整体应用性能提升

### 方向 4: 新功能开发

**目标**：扩展应用功能边界

**具体内容**：
- **笔记平台集成**：支持导出到 Notion、Obsidian、飞书等平台
- **RAG 实现**：让 AI Tutor 记住用户的学习历史
  - 跨会话记忆用户学习进度
  - 引用之前学过的材料进行强化学习
  - 从单次对话工具升级为个性化学习伙伴

### 方向 5: 安全合规

**目标**：确保商业软件安全标准

**具体内容**：
- 代码安全审计
- 数据隐私保护
- 商业软件合规性检查

**优先级**：**最高** - 安全性在所有开发考量中处于最高优先级

### 方向 6: 后端维护

**目标**：修复 bug、清理遗留代码

**具体内容**：
- 修复已知 bug
- 清理无用的遗留代码
- 代码重构和优化

---

## 代码审计发现

在讨论过程中，对后端代码进行了全面审计，发现以下问题：

### 架构概述

- 后端采用 FastAPI 框架
- 分层架构：Routes → Service → AI/LLM → Data
- 三个核心数据模型：
  - `MediaSource`：视频元数据
  - `SubtitleSegment`：转录片段
  - `SavedWord`：生词本（支持 SM-2 间隔重复）

### 发现的问题

| 问题 | 严重程度 | 说明 |
|------|----------|------|
| `audio_service.py` 完全未使用 | 高 | 死代码，yt-dlp 的 FFmpeg 后处理已经处理音频提取 |
| 8 个孤立的测试文件 | 中 | `test_download*.py` 等文件散落在根目录 |
| `translation_cache.py` 未使用的 import | 低 | `lru_cache` import 未使用 |
| 空的 `fluent_learner.db` 文件 | 低 | 之前 schema 迁移遗留的空文件 |
| Chat endpoint 忽略用户 LLM 配置 | 中 | 总是使用服务器默认配置 |

---

## 用户决策

### 最终选择：方向 6 - 后端维护/Bug 修复

**理由**：
1. 当前 v0.0.7 核心功能已经稳定
2. 后端存在遗留代码和 bug 需要清理
3. 在添加新功能之前，先确保代码库的健康

### 执行策略决策

**用户要求**：使用新分支进行所有修改操作

**原因**：
- 担心设计修改可能影响程序稳定性
- 文件删除操作可能影响现有系统
- 需要一个安全的隔离环境进行修改

**决定**：创建 `refactor/backend-cleanup` 分支执行所有清理操作

---

## 执行计划

### Phase 1: 代码清理 ✅

- [x] 创建 `refactor/backend-cleanup` 分支
- [x] 删除 8 个孤立的测试文件
- [x] 删除未使用的 `audio_service.py`
- [x] 清理 `translation_cache.py` 中未使用的 import
- [x] 删除空的数据库文件

### Phase 2: Bug 修复 ✅

- [x] 修复翻译批处理解析 bug（部分片段无翻译）
- [x] 优化 Whisper VAD 参数（静音时长 400ms → 700ms）
- [x] 实现智能短句合并（<2秒且无完整标点的片段合并）

### Phase 3: 文档和代码质量 ✅

- [x] 修复 Chat endpoint 过时注释（功能实际已实现，注释说未实现）
- [x] 代码提交到主分支
- [x] 发布 v0.0.8 版本

### Phase 4: UI/UX 改进 (2026-01-21) ✅

- [x] 修复启动画面图标加载失败问题
- [x] LearningPanel 可拖拽改进（react-rnd）
- [x] 字幕可拖拽+调整大小+磨砂玻璃效果
- [x] LLM 设置滚动条颜色统一
- [x] 替换原生 alert() 为 Toast 通知系统
- [x] 全屏模式字幕显示修复（自定义全屏按钮）
- [x] 窗口调整时字幕位置保持（相对百分比定位）
- [x] 发布 v0.0.9, v0.0.10 版本

### Phase 5: 双击全屏修复 (2026-01-21) ✅

- [x] 修复双击视频进入全屏时字幕不显示问题
- [x] 添加透明点击覆盖层拦截双击事件
- [x] 多语言 README 重构（英文、中文、日文）
- [x] 发布 v0.0.11 版本
- [x] GitHub Release: https://github.com/haanc/LinguaMaster/releases/tag/v0.0.11

### Phase 6: 后端稳定性修复 (2026-01-23) ✅

- [x] 用户报告：关闭应用再打开后遇到 Server Error 500
- [x] 初步调查：确认孤儿 Python 进程问题
- [x] 深入调查：发现两层原因
  - ESM 模块中 `require` 不可用，导致 `spawnSync` 无法导入
  - 无边框窗口关闭太快，cleanup 代码来不及执行
- [x] 修复：静态导入 `spawnSync` + `event.preventDefault()` 控制关闭流程
- [x] 发布 v0.1.0 版本
- [x] GitHub Release: https://github.com/haanc/LinguaMaster/releases/tag/v0.1.0

---

## 后续规划

完成后端稳定性优化后，建议按以下优先级处理其他方向：

1. **安全合规** - 最高优先级，商业化前置条件
2. **性能优化** - 用户体验关键
3. **商业化** - 收入来源
4. **新功能开发** - 产品差异化

---

## 版本发布历史

| 版本 | 日期 | 主要内容 |
|------|------|----------|
| v0.0.7 | 2026-01-19 | 初始稳定版本 |
| v0.0.8 | 2026-01-20 | 后端清理、翻译 bug 修复 |
| v0.0.9 | 2026-01-21 | 可拖拽 UI、Toast 通知、全屏字幕修复 |
| v0.0.10 | 2026-01-21 | 字幕初始渲染修复 (ResizeObserver) |
| v0.0.11 | 2026-01-21 | 双击全屏字幕修复、多语言 README |
| v0.1.0 | 2026-01-23 | 修复关闭应用后 Python 进程未终止问题 |

---

## 相关文档

- [Bug Fix: 翻译部分缺失问题](../bug-fix-docs/2026-01-20_翻译部分缺失问题.md)
- [Bug Fix: 全屏字幕显示与相对位置修复](../bug-fix-docs/2026-01-21_全屏字幕显示与相对位置修复.md)
- [Bug Fix: 双击全屏不显示字幕修复](../bug-fix-docs/2026-01-21_双击全屏不显示字幕修复.md)
- [Bug Fix: 关闭应用后Python后端进程未终止修复](../bug-fix-docs/2026-01-23_关闭应用后Python后端进程未终止修复.md)
- [每日进展: 2026-01-21](../Project%20Daily%20Summary/project-daily-summary-2026-01-21.md)

---

*文档生成时间：2026-01-20 20:35 (UTC+8)*
*最后更新时间：2026-01-23 16:00 (UTC+8)*
