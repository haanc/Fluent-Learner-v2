# User Flow: The First Learning Loop (Core Loop)

这个流程描述了用户**首次打开应用**，直到完成**第一次沉浸式学习体验**的关键路径。

---

## 🧭 Flow Overview (流程概览)
1.  **Home / Import** (首页/导入)
2.  **Processing** (智能处理中)
3.  **Library** (媒体库)
4.  **Player (Immersive Mode)** (沉浸播放器)

---

## 1. 首页 / 导入 (Home & Import View)
**目标**：让用户极其简单地开始。

*   **界面元素**：
    *   一个巨大的、诱人的拖拽区域 ("Drop Video Here")。
    *   一个 URL 输入框 (YouTube/Bilibili)。
    *   简单的 "Recent" (最近项目) 列表（初始为空）。
*   **交互**：用户拖入视频文件 或 粘贴 URL -> 点击 "Start Magic"。
*   **📊 数据操作 (Data I/O)**：
    *   **READ**: `SELECT * FROM MediaSource ORDER BY last_played_at DESC LIMIT 5` (显示最近记录)。
    *   **WRITE**: 无 (点击开始后，进入下一步才创建数据)。

## 2. 处理中 (Processing View)
**目标**：缓解等待焦虑，展示 AI 正在工作。

*   **界面元素**：
    *   进度条 + 趣味文案 ("Listening to audio...", "Consulting AI Tutor...").
    *   后台日志流 (Log Stream).
*   **后台逻辑 (Python Pipeline)**：
    1.  提取音频 (`yt-dlp` / `ffmpeg`)。
    2.  Whisper 转录 -> 得到字幕数据。
    3.  (可选) 初步 AI 分析。
*   **📊 数据操作 (Data I/O)**：
    *   **WRITE (Create)**: 插入 `MediaSource` 记录 (title, path, duration)。
    *   **WRITE (Batch)**: 插入数百条 `SubtitleSegment` 记录 (start, end, text)。

## 3. 媒体库 (Library View)
**目标**：处理完成，用户看到了自己的“藏书阁”。

*   **界面元素**：
    *   网格状的视频卡片 (Cover Image)。
    *   每个卡片上有 "New" 标签。
*   **交互**：用户点击刚刚处理好的那个视频卡片。
*   **📊 数据操作 (Data I/O)**：
    *   **READ**: `SELECT * FROM MediaSource`。

## 4. 沉浸播放器 (Player View) - ⭐ 核心战场
**目标**：Flow 状态。用户不再操作软件，而在消费内容。

*   **界面布局**：
    *   **左侧 (70%)**: 视频播放器 (Native Video Element)。
    *   **右侧 (30%)**: 交互式字幕流 (Subtitle Stream)。
*   **交互 A：观看与跟读**
    *   视频播放 -> 字幕自动滚动高亮。
    *   **READ**: `SELECT * FROM SubtitleSegment WHERE media_id = ?` (一次性加载所有字幕)。
    *   **WRITE**: 更形 `MediaSource.last_played_at`。
*   **交互 B：即时查词 (On-Demand Tread)**
    *   用户在右侧字幕栏，点击某个生词 (或整句)。
    *   **UI 响应**：视频自动暂停。弹出一个 Popover (气泡卡片)，显示 GPT 生成的针对该句的解释。
    *   **(可选) 写入生词本**：用户点击气泡卡片上的 "Add to Vocab" 按钮。
    *   **WRITE**: `INSERT INTO VocabularyItem (media_id, segment_id, word, context_snapshot...)`。

---

## ✅ Flow Complete
至此，用户完成了从“拥有一个视频文件”到“向生词本存入第一个单词”的完整闭环。
